"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.retry = void 0;
const util_1 = require("./util");
function delay(time) {
    return new Promise((resolve) => {
        setTimeout(() => resolve(), time);
    });
}
async function retry(functionToRetry, options) {
    const timeout = options?.timeout !== undefined ? options?.timeout : 4000;
    const delayBetweenTries = options?.delayBetweenTries !== undefined ? options?.delayBetweenTries : 200;
    const makeAttempt = async (timeElapsed = 0) => {
        try {
            return await functionToRetry();
        }
        catch (err) {
            await delay(delayBetweenTries);
            if (timeElapsed >= timeout) {
                throw (0, util_1.pluginError)(`Failed retrying after ${timeout}ms: ${err.message}`);
            }
            return makeAttempt(timeElapsed + delayBetweenTries);
        }
    };
    return makeAttempt();
}
exports.retry = retry;
